<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrendRadar é…ç½®ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 15px;
            color: #666;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            position: relative;
            bottom: -2px;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 120px;
            font-family: 'Courier New', monospace;
        }

        .form-group .hint {
            font-size: 12px;
            color: #6b7280;
            margin-top: 5px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .notification-channels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .channel-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }

        .channel-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .channel-card h3 {
            margin-bottom: 15px;
            color: #667eea;
            font-size: 16px;
        }

        .platform-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .platform-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
        }

        .platform-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }

        .platform-item span {
            flex: 1;
        }

        .btn-sm {
            padding: 5px 10px;
            font-size: 12px;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .channel-status {
            margin-bottom: 10px;
        }

        .channel-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            background: #10b981;
            color: white;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
        }

        .status-badge-gray {
            display: inline-block;
            padding: 5px 12px;
            background: #9ca3af;
            color: white;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 18px;
            color: #374151;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #9ca3af;
            cursor: pointer;
            line-height: 1;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .rss-feed-list {
            margin-top: 20px;
        }

        .rss-feed-item {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .rss-feed-item:last-child {
            margin-bottom: 0;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .toast.success {
            background: #10b981;
        }

        .toast.error {
            background: #ef4444;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f4f6;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* å…³é”®è¯é…ç½®è§„åˆ™æ ·å¼ */
        .config-rules {
            margin-top: 40px;
            padding: 25px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .config-rules h3 {
            margin-bottom: 20px;
            color: #374151;
            font-size: 18px;
        }

        .rule-section {
            margin-bottom: 20px;
        }

        .rule-section:last-child {
            margin-bottom: 0;
        }

        .rule-section h4 {
            margin-bottom: 10px;
            color: #667eea;
            font-size: 15px;
        }

        .rule-section ul {
            list-style: none;
            padding-left: 0;
        }

        .rule-section li {
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .rule-section li:last-child {
            border-bottom: none;
        }

        .rule-section code {
            background: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            color: #667eea;
            border: 1px solid #e5e7eb;
        }

        .rule-section pre {
            background: #fff;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            overflow-x: auto;
            margin-top: 10px;
        }

        .rule-section pre code {
            background: none;
            padding: 0;
            border: none;
            color: #374151;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            header {
                padding: 20px;
            }

            header h1 {
                font-size: 22px;
            }

            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                padding: 10px 16px;
                font-size: 14px;
                white-space: nowrap;
            }

            .tab-content {
                padding: 20px 15px;
            }

            .notification-channels {
                grid-template-columns: 1fr;
            }

            .platform-list {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .button-group .btn {
                width: 100%;
            }

            .modal-content {
                width: 95%;
                max-height: 90vh;
            }

            .modal-header,
            .modal-body,
            .modal-footer {
                padding: 15px;
            }

            .channel-actions {
                flex-direction: column;
            }

            .channel-actions .btn {
                width: 100%;
            }

            .config-rules {
                padding: 15px;
            }

            .rule-section pre {
                font-size: 12px;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 18px;
            }

            header p {
                font-size: 12px;
            }

            .tab {
                padding: 8px 12px;
                font-size: 13px;
            }

            .form-group label {
                font-size: 14px;
            }

            .form-group input,
            .form-group textarea,
            .form-group select {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”¥ TrendRadar é…ç½®ç®¡ç†</h1>
            <p>åŠ¨æ€ç®¡ç†é€šçŸ¥æ¸ é“ã€RSSè®¢é˜…ã€æ–°é—»å¹³å°å’Œå…³é”®è¯é…ç½®</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">ğŸ“¢ é€šçŸ¥æ¸ é“</button>
            <button class="tab" onclick="switchTab(1)">ğŸ“° RSSè®¢é˜…</button>
            <button class="tab" onclick="switchTab(2)">ğŸŒ æ–°é—»å¹³å°</button>
            <button class="tab" onclick="switchTab(3)">ğŸ”‘ å…³é”®è¯</button>
            <button class="tab" onclick="switchTab(4)">ğŸ“Š æŠ¥å‘Šé…ç½®</button>
            <button class="tab" onclick="switchTab(5)">â° æ¨é€è®¾ç½®</button>
            <button class="tab" onclick="switchTab(6)">ğŸ’¾ å­˜å‚¨é…ç½®</button>
            <button class="tab" onclick="switchTab(7)">âš™ï¸ é«˜çº§è®¾ç½®</button>
        </div>

        <!-- é€šçŸ¥æ¸ é“é…ç½® -->
        <div class="tab-content active">
            <h2>é€šçŸ¥æ¸ é“é…ç½®</h2>
            <div class="notification-channels" id="notification-channels"></div>
            <!-- é€šçŸ¥é…ç½®è‡ªåŠ¨ä¿å­˜ï¼Œæ— éœ€æ‰‹åŠ¨ä¿å­˜æŒ‰é’® -->
        </div>

        <!-- RSS è®¢é˜…é…ç½® -->
        <div class="tab-content">
            <h2>RSS è®¢é˜…é…ç½®</h2>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="rss-enabled"> å¯ç”¨ RSS æŠ“å–
                </label>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">ğŸ“… æ–°é²œåº¦è¿‡æ»¤</h3>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="rss-freshness-enabled"> å¯ç”¨æ–°é²œåº¦è¿‡æ»¤
                </label>
                <div class="hint">è¿‡æ»¤æ‰å‘å¸ƒæ—¶é—´è¶…è¿‡æŒ‡å®šå¤©æ•°çš„æ—§æ–‡ç« </div>
            </div>
            <div class="form-group">
                <label>æœ€å¤§æ–‡ç« å¹´é¾„ï¼ˆå¤©ï¼‰</label>
                <input type="number" id="rss-max-age-days" min="0" placeholder="3">
                <div class="hint">åªæ¨é€ N å¤©å†…çš„æ–‡ç« ï¼Œè®¾ä¸º 0 ç¦ç”¨è¿‡æ»¤</div>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">ğŸ“¡ è®¢é˜…æºåˆ—è¡¨</h3>
            <div id="rss-feeds-container"></div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="saveRSSConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                <button class="btn btn-secondary" onclick="addRSSFeed()">â• æ·»åŠ è®¢é˜…æº</button>
            </div>
        </div>

        <!-- æ–°é—»å¹³å°é…ç½® -->
        <div class="tab-content">
            <h2>æ–°é—»å¹³å°é…ç½®</h2>
            <div class="platform-list" id="platforms-list"></div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="savePlatformsConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                <button class="btn btn-secondary" onclick="addPlatform()">â• æ·»åŠ å¹³å°</button>
            </div>
        </div>

        <!-- å…³é”®è¯é…ç½® -->
        <div class="tab-content">
            <h2>å…³é”®è¯é…ç½®</h2>
            <div class="form-group">
                <label>é¢‘ç‡è¯åˆ—è¡¨ï¼ˆæ¯è¡Œä¸€ä¸ªå…³é”®è¯ï¼‰</label>
                <textarea id="keywords-textarea" placeholder="AI&#10;ç‰¹æ–¯æ‹‰&#10;æ¯”äºšè¿ª&#10;..."></textarea>
                <div class="hint">ä¸€è¡Œä¸€ä¸ªå…³é”®è¯ï¼ŒåŒ¹é…åˆ°è¿™äº›è¯çš„æ–°é—»ä¼šè¢«æ¨é€</div>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="saveKeywords()">ğŸ’¾ ä¿å­˜å…³é”®è¯</button>
            </div>

            <!-- å…³é”®è¯é…ç½®è§„åˆ™è¯´æ˜ -->
            <div class="config-rules">
                <h3>ğŸ“– å…³é”®è¯é…ç½®è§„åˆ™</h3>
                <div class="rule-section">
                    <h4>åŸºç¡€è¯­æ³•</h4>
                    <ul>
                        <li><strong>æ™®é€šå…³é”®è¯</strong>ï¼šç›´æ¥è¾“å…¥ï¼Œå¦‚ <code>AI</code>ã€<code>ç‰¹æ–¯æ‹‰</code></li>
                        <li><strong>å¿…é¡»è¯</strong>ï¼šä½¿ç”¨ <code>+</code> å‰ç¼€ï¼Œå¦‚ <code>+æ‰‹æœº</code>ï¼ˆå¿…é¡»åŒæ—¶åŒ…å«ï¼‰</li>
                        <li><strong>è¿‡æ»¤è¯</strong>ï¼šä½¿ç”¨ <code>!</code> å‰ç¼€ï¼Œå¦‚ <code>!å¹¿å‘Š</code>ï¼ˆæ’é™¤åŒ…å«æ­¤è¯çš„æ–°é—»ï¼‰</li>
                        <li><strong>æ•°é‡é™åˆ¶</strong>ï¼šä½¿ç”¨ <code>@æ•°å­—</code>ï¼Œå¦‚ <code>@10</code>ï¼ˆé™åˆ¶æ˜¾ç¤º10æ¡ï¼‰</li>
                        <li><strong>æ­£åˆ™è¡¨è¾¾å¼</strong>ï¼šä½¿ç”¨ <code>/pattern/</code>ï¼Œå¦‚ <code>/\bai\b/</code>ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰</li>
                        <li><strong>æ˜¾ç¤ºåç§°</strong>ï¼šä½¿ç”¨ <code>=> å¤‡æ³¨</code>ï¼Œå¦‚ <code>/\bai\b/ => AIç›¸å…³</code></li>
                    </ul>
                </div>
                <div class="rule-section">
                    <h4>è¯ç»„åŠŸèƒ½</h4>
                    <p>ä½¿ç”¨<strong>ç©ºè¡Œ</strong>åˆ†éš”ä¸åŒçš„è¯ç»„ï¼Œæ¯ä¸ªè¯ç»„ç‹¬ç«‹ç»Ÿè®¡ã€‚</p>
                    <pre><code>åä¸º
OPPO
+æ‰‹æœº

ç‰¹æ–¯æ‹‰
æ¯”äºšè¿ª
!å¹¿å‘Š</code></pre>
                </div>
                <div class="rule-section">
                    <h4>å…¨å±€è¿‡æ»¤</h4>
                    <p>ä½¿ç”¨ <code>[GLOBAL_FILTER]</code> æ ‡è®°å…¨å±€è¿‡æ»¤åŒºï¼š</p>
                    <pre><code>[GLOBAL_FILTER]
å¹¿å‘Š
æ¨å¹¿

[WORD_GROUPS]
AI
ç§‘æŠ€</code></pre>
                </div>
            </div>
        </div>

        <!-- æŠ¥å‘Šé…ç½® -->
        <div class="tab-content">
            <h2>ğŸ“Š æŠ¥å‘Šé…ç½®</h2>

            <div class="form-group">
                <label>æŠ¥å‘Šæ¨¡å¼</label>
                <select id="report-mode">
                    <option value="daily">å½“æ—¥æ±‡æ€»æ¨¡å¼ - æ¨é€å½“æ—¥æ‰€æœ‰åŒ¹é…æ–°é—»</option>
                    <option value="current">å½“å‰æ¦œå•æ¨¡å¼ - æ¨é€å½“å‰æ¦œå•åŒ¹é…æ–°é—»</option>
                    <option value="incremental">å¢é‡ç›‘æ§æ¨¡å¼ - ä»…æ¨é€æ–°å¢åŒ¹é…æ–°é—»</option>
                </select>
                <div class="hint">ä¸åŒæ¨¡å¼å½±å“æ¨é€å†…å®¹å’Œæ—¶æœº</div>
            </div>

            <div class="form-group">
                <label>æ˜¾ç¤ºæ¨¡å¼</label>
                <select id="report-display-mode">
                    <option value="keyword">æŒ‰å…³é”®è¯åˆ†ç»„æ˜¾ç¤º</option>
                    <option value="platform">æŒ‰å¹³å°åˆ†ç»„æ˜¾ç¤º</option>
                </select>
            </div>

            <div class="form-group">
                <label>æ’åé«˜äº®é˜ˆå€¼</label>
                <input type="number" id="report-rank-threshold" min="1" placeholder="5">
                <div class="hint">æ’ååœ¨æ­¤é˜ˆå€¼å†…çš„æ–°é—»ä¼šè¢«é«˜äº®æ˜¾ç¤º</div>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="report-sort-by-position"> æŒ‰é…ç½®ä½ç½®ä¼˜å…ˆæ’åº
                </label>
                <div class="hint">å¯ç”¨åæŒ‰å…³é”®è¯åœ¨é…ç½®æ–‡ä»¶ä¸­çš„ä½ç½®æ’åºï¼Œå¦åˆ™æŒ‰çƒ­ç‚¹æ¡æ•°æ’åº</div>
            </div>

            <div class="form-group">
                <label>æ¯ä¸ªå…³é”®è¯æœ€å¤§æ˜¾ç¤ºæ•°é‡</label>
                <input type="number" id="report-max-news" min="0" placeholder="0">
                <div class="hint">è®¾ä¸º 0 è¡¨ç¤ºä¸é™åˆ¶</div>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="report-reverse-order"> æ–°å¢çƒ­ç‚¹æ–°é—»åœ¨å‰
                </label>
                <div class="hint">false=çƒ­ç‚¹è¯æ±‡ç»Ÿè®¡åœ¨å‰ï¼Œtrue=æ–°å¢çƒ­ç‚¹æ–°é—»åœ¨å‰</div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="saveReportConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
            </div>
        </div>

        <!-- æ¨é€è®¾ç½® -->
        <div class="tab-content">
            <h2>â° æ¨é€æ—¶é—´çª—å£</h2>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="push-window-enabled"> å¯ç”¨æ¨é€æ—¶é—´çª—å£æ§åˆ¶
                </label>
                <div class="hint">é™åˆ¶æ¨é€çš„æ—¶é—´èŒƒå›´ï¼Œé¿å…éå·¥ä½œæ—¶é—´æ‰“æ‰°</div>
            </div>

            <div class="form-group">
                <label>å¼€å§‹æ—¶é—´</label>
                <input type="time" id="push-window-start" placeholder="20:00">
                <div class="hint">æ¨é€çª—å£å¼€å§‹æ—¶é—´ï¼ˆ24å°æ—¶åˆ¶ï¼‰</div>
            </div>

            <div class="form-group">
                <label>ç»“æŸæ—¶é—´</label>
                <input type="time" id="push-window-end" placeholder="22:00">
                <div class="hint">æ¨é€çª—å£ç»“æŸæ—¶é—´ï¼ˆ24å°æ—¶åˆ¶ï¼‰</div>
            </div>

            <div class="form-group">
                <label>
                    <input type="checkbox" id="push-window-once"> çª—å£å†…åªæ¨é€ä¸€æ¬¡
                </label>
                <div class="hint">å¯ç”¨ååœ¨æ—¶é—´çª—å£å†…åªæ¨é€ä¸€æ¬¡ï¼Œå¦åˆ™æ¯æ¬¡æ‰§è¡Œéƒ½æ¨é€</div>
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="savePushWindowConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
            </div>
        </div>

        <!-- å­˜å‚¨é…ç½® -->
        <div class="tab-content">
            <h2>ğŸ’¾ å­˜å‚¨é…ç½®</h2>

            <h3 style="margin-bottom: 15px;">å­˜å‚¨åç«¯</h3>
            <div class="form-group">
                <label>å­˜å‚¨åç«¯é€‰æ‹©</label>
                <select id="storage-backend">
                    <option value="auto">è‡ªåŠ¨é€‰æ‹©</option>
                    <option value="local">æœ¬åœ°å­˜å‚¨</option>
                    <option value="remote">è¿œç¨‹å­˜å‚¨ï¼ˆS3å…¼å®¹ï¼‰</option>
                </select>
                <div class="hint">auto: è‡ªåŠ¨é€‰æ‹©ï¼›local: æœ¬åœ°SQLiteï¼›remote: äº‘å­˜å‚¨</div>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">æ•°æ®æ ¼å¼</h3>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="storage-format-sqlite" checked disabled> SQLiteæ•°æ®åº“ï¼ˆå¿…é€‰ï¼‰
                </label>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="storage-format-txt"> TXTæ–‡æœ¬æ ¼å¼
                </label>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="storage-format-html"> HTMLæŠ¥å‘Šæ ¼å¼
                </label>
                <div class="hint">âš ï¸ é‚®ä»¶æ¨é€å¿…é¡»å¯ç”¨HTMLæ ¼å¼</div>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">æœ¬åœ°å­˜å‚¨</h3>
            <div class="form-group">
                <label>æ•°æ®ç›®å½•</label>
                <input type="text" id="storage-local-dir" placeholder="output">
            </div>
            <div class="form-group">
                <label>æ•°æ®ä¿ç•™å¤©æ•°</label>
                <input type="number" id="storage-local-retention" min="0" placeholder="0">
                <div class="hint">è®¾ä¸º 0 è¡¨ç¤ºæ°¸ä¹…ä¿ç•™</div>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">è¿œç¨‹å­˜å‚¨ï¼ˆS3å…¼å®¹ï¼‰</h3>
            <div class="form-group">
                <label>ç«¯ç‚¹URL</label>
                <input type="text" id="storage-remote-endpoint" placeholder="https://xxx.r2.cloudflarestorage.com">
                <div class="hint">æ”¯æŒ Cloudflare R2ã€é˜¿é‡Œäº‘OSSã€è…¾è®¯äº‘COSç­‰</div>
            </div>
            <div class="form-group">
                <label>å­˜å‚¨æ¡¶åç§°</label>
                <input type="text" id="storage-remote-bucket" placeholder="my-bucket">
            </div>
            <div class="form-group">
                <label>è®¿é—®å¯†é’¥ID</label>
                <input type="text" id="storage-remote-access-key" placeholder="Access Key ID">
            </div>
            <div class="form-group">
                <label>è®¿é—®å¯†é’¥</label>
                <input type="password" id="storage-remote-secret-key" placeholder="Secret Access Key">
            </div>
            <div class="form-group">
                <label>åŒºåŸŸ</label>
                <input type="text" id="storage-remote-region" placeholder="autoï¼ˆå¯é€‰ï¼‰">
            </div>
            <div class="form-group">
                <label>æ•°æ®ä¿ç•™å¤©æ•°</label>
                <input type="number" id="storage-remote-retention" min="0" placeholder="0">
                <div class="hint">è®¾ä¸º 0 è¡¨ç¤ºæ°¸ä¹…ä¿ç•™</div>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">æ•°æ®æ‹‰å–</h3>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="storage-pull-enabled"> å¯ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‹‰å–
                </label>
                <div class="hint">ä»è¿œç¨‹åŒæ­¥æ•°æ®åˆ°æœ¬åœ°ï¼ˆç”¨äºMCP Serverç­‰åœºæ™¯ï¼‰</div>
            </div>
            <div class="form-group">
                <label>æ‹‰å–æœ€è¿‘å¤©æ•°</label>
                <input type="number" id="storage-pull-days" min="1" placeholder="7">
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="saveStorageConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
            </div>
        </div>

        <!-- é«˜çº§è®¾ç½® -->
        <div class="tab-content">
            <h2>âš™ï¸ é«˜çº§è®¾ç½®</h2>

            <h3 style="margin-bottom: 15px;">åº”ç”¨è®¾ç½®</h3>
            <div class="form-group">
                <label>æ—¶åŒº</label>
                <input type="text" id="app-timezone" placeholder="Asia/Shanghai">
                <div class="hint">å½±å“æ‰€æœ‰æ—¶é—´æ˜¾ç¤ºã€æ¨é€çª—å£åˆ¤æ–­ã€æ•°æ®å­˜å‚¨</div>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="app-show-version-update"> æ˜¾ç¤ºç‰ˆæœ¬æ›´æ–°æç¤º
                </label>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">çˆ¬è™«è®¾ç½®</h3>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="crawler-enabled"> å¯ç”¨çˆ¬è™«åŠŸèƒ½
                </label>
            </div>
            <div class="form-group">
                <label>è¯·æ±‚é—´éš”ï¼ˆæ¯«ç§’ï¼‰</label>
                <input type="number" id="crawler-interval" min="0" placeholder="1000">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="crawler-use-proxy"> ä½¿ç”¨ä»£ç†
                </label>
            </div>
            <div class="form-group">
                <label>é»˜è®¤ä»£ç†åœ°å€</label>
                <input type="text" id="crawler-proxy" placeholder="http://127.0.0.1:10801">
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">RSSé«˜çº§è®¾ç½®</h3>
            <div class="form-group">
                <label>è¯·æ±‚é—´éš”ï¼ˆæ¯«ç§’ï¼‰</label>
                <input type="number" id="rss-adv-interval" min="0" placeholder="2000">
            </div>
            <div class="form-group">
                <label>è¯·æ±‚è¶…æ—¶ï¼ˆç§’ï¼‰</label>
                <input type="number" id="rss-adv-timeout" min="1" placeholder="15">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="rss-adv-use-proxy"> ä½¿ç”¨ä»£ç†
                </label>
            </div>
            <div class="form-group">
                <label>RSSä¸“å±ä»£ç†</label>
                <input type="text" id="rss-adv-proxy" placeholder="ç•™ç©ºåˆ™ä½¿ç”¨çˆ¬è™«ä»£ç†">
                <div class="hint">ç•™ç©ºåˆ™ä½¿ç”¨ crawler.default_proxy</div>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="rss-adv-notification"> å¯ç”¨RSSé€šçŸ¥æ¨é€
                </label>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">æ’åºæƒé‡</h3>
            <div class="form-group">
                <label>æ’åæƒé‡ï¼ˆ0-1ï¼‰</label>
                <input type="number" id="weight-rank" min="0" max="1" step="0.1" placeholder="0.6">
            </div>
            <div class="form-group">
                <label>é¢‘æ¬¡æƒé‡ï¼ˆ0-1ï¼‰</label>
                <input type="number" id="weight-frequency" min="0" max="1" step="0.1" placeholder="0.3">
            </div>
            <div class="form-group">
                <label>çƒ­åº¦æƒé‡ï¼ˆ0-1ï¼‰</label>
                <input type="number" id="weight-hotness" min="0" max="1" step="0.1" placeholder="0.1">
            </div>
            <div class="hint" style="margin-bottom: 20px;">ä¸‰ä¸ªæƒé‡ç›¸åŠ åº”ç­‰äº 1.0</div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">å…¶ä»–è®¾ç½®</h3>
            <div class="form-group">
                <label>æ¯ä¸ªæ¸ é“æœ€å¤§è´¦å·æ•°</label>
                <input type="number" id="max-accounts" min="1" placeholder="3">
            </div>
            <div class="form-group">
                <label>æ‰¹æ¬¡å‘é€é—´éš”ï¼ˆç§’ï¼‰</label>
                <input type="number" id="batch-interval" min="0" step="0.1" placeholder="3">
            </div>

            <div class="button-group">
                <button class="btn btn-primary" onclick="saveAdvancedConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                <button class="btn btn-success" onclick="restartContainer()">ğŸ”„ é‡å¯å®¹å™¨</button>
            </div>
        </div>
    </div>

    <script>
        let currentConfig = {};

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(index) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');

            tabs.forEach((tab, i) => {
                if (i === index) {
                    tab.classList.add('active');
                    contents[i].classList.add('active');
                } else {
                    tab.classList.remove('active');
                    contents[i].classList.remove('active');
                }
            });
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // åŠ è½½å®Œæ•´é…ç½®
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                const result = await response.json();
                if (result.success) {
                    currentConfig = result.data;
                    renderNotificationChannels();
                    renderRSSConfig();
                    renderPlatforms();
                    loadKeywords();
                    loadReportConfig();
                    loadPushWindowConfig();
                    loadStorageConfig();
                    loadAdvancedConfig();
                }
            } catch (error) {
                showToast('é…ç½®åŠ è½½å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ¸²æŸ“é€šçŸ¥æ¸ é“
        function renderNotificationChannels() {
            const container = document.getElementById('notification-channels');
            const notification = currentConfig.notification || {};
            const channels = notification.channels || {};

            const channelConfigs = [
                { key: 'feishu', name: 'é£ä¹¦', fields: ['webhook_url'], required: ['webhook_url'] },
                { key: 'dingtalk', name: 'é’‰é’‰', fields: ['webhook_url'], required: ['webhook_url'] },
                { key: 'wework', name: 'ä¼ä¸šå¾®ä¿¡', fields: ['webhook_url', 'msg_type'], required: ['webhook_url'] },
                { key: 'telegram', name: 'Telegram', fields: ['bot_token', 'chat_id'], required: ['bot_token', 'chat_id'] },
                { key: 'serverchan', name: 'Serveré…±Â³', fields: ['uid', 'sendkey'], required: ['uid', 'sendkey'] },
                { key: 'bark', name: 'Bark', fields: ['url'], required: ['url'] },
                { key: 'slack', name: 'Slack', fields: ['webhook_url'], required: ['webhook_url'] },
                { key: 'ntfy', name: 'ntfy', fields: ['server_url', 'topic', 'token'], required: ['topic'] },
                { key: 'email', name: 'é‚®ä»¶', fields: ['from', 'password', 'to', 'smtp_server', 'smtp_port'], required: ['from', 'password', 'to', 'smtp_server'] }
            ];

            container.innerHTML = channelConfigs.map(config => {
                const channelData = channels[config.key] || {};

                // æ£€æŸ¥æ˜¯å¦å·²é…ç½®ï¼ˆå¿…éœ€å­—æ®µæœ‰å€¼ï¼‰
                const isConfigured = config.required.some(field => channelData[field]);

                // è®¡ç®—è´¦å·æ•°é‡ï¼ˆè§£æåˆ†å·åˆ†éš”çš„å¤šè´¦å·ï¼‰
                let accountCount = 0;
                if (isConfigured && config.required.length > 0) {
                    const firstRequiredField = config.required[0];
                    const value = channelData[firstRequiredField];
                    if (value) {
                        accountCount = value.split(';').filter(v => v.trim()).length;
                    }
                }

                return `
                    <div class="channel-card">
                        <h3>${config.name}</h3>
                        <div class="channel-status">
                            ${isConfigured ?
                                `<span class="status-badge">âœ“ å·²é…ç½® (${accountCount}ä¸ªè´¦å·)</span>` :
                                `<span class="status-badge-gray">æœªé…ç½®</span>`
                            }
                        </div>
                        <div class="channel-actions">
                            <button class="btn btn-secondary btn-sm" onclick="showAddChannelForm('${config.key}', '${config.name}', ${JSON.stringify(config.fields).replace(/"/g, '&quot;')})">â• æ·»åŠ è´¦å·</button>
                            ${isConfigured ?
                                `<button class="btn btn-danger btn-sm" onclick="deleteChannel('${config.key}')">ğŸ—‘ï¸ åˆ é™¤æ‰€æœ‰</button>` :
                                ''
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ˜¾ç¤ºæ·»åŠ æ¸ é“è¡¨å•
        function showAddChannelForm(channelKey, channelName, fields) {
            const fieldsArray = typeof fields === 'string' ? JSON.parse(fields) : fields;

            const fieldsHTML = fieldsArray.map(field => {
                const fieldName = field.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
                const inputType = field.includes('password') || field.includes('key') || field.includes('token') ? 'password' : 'text';

                let placeholder = `è¯·è¾“å…¥${fieldName}`;
                let defaultValue = '';
                let hint = '';

                if (field === 'msg_type') {
                    placeholder = 'markdown';
                    defaultValue = 'markdown';
                    hint = 'å¯é€‰: markdown æˆ– textï¼Œé»˜è®¤ markdown';
                } else if (field === 'server_url') {
                    placeholder = 'https://ntfy.sh';
                    defaultValue = 'https://ntfy.sh';
                    hint = 'é»˜è®¤: https://ntfy.sh';
                } else if (field === 'token') {
                    hint = 'å¯é€‰ï¼Œç”¨äºç§æœ‰ä¸»é¢˜è®¤è¯';
                } else if (field === 'smtp_port') {
                    placeholder = '465 æˆ– 587';
                    hint = 'SSL: 465, TLS: 587';
                }

                return `
                    <div class="form-group">
                        <label>${fieldName}</label>
                        <input type="${inputType}"
                               id="add-${channelKey}-${field}"
                               placeholder="${placeholder}"
                               value="${defaultValue}">
                        ${hint ? `<div class="hint">${hint}</div>` : ''}
                    </div>
                `;
            }).join('');

            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>æ·»åŠ  ${channelName} é…ç½®</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        ${fieldsHTML}
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="addChannel('${channelKey}', ${JSON.stringify(fieldsArray).replace(/"/g, '&quot;')})">ç¡®è®¤æ·»åŠ </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // æ·»åŠ æ¸ é“é…ç½®
        function addChannel(channelKey, fields) {
            const fieldsArray = typeof fields === 'string' ? JSON.parse(fields) : fields;
            const channelData = {};

            fieldsArray.forEach(field => {
                const input = document.getElementById(`add-${channelKey}-${field}`);
                if (input && input.value) {
                    channelData[field] = input.value;
                }
            });

            // æ›´æ–°é…ç½®ï¼ˆæ”¯æŒå¤šè´¦å·è¿½åŠ ï¼‰
            if (!currentConfig.notification.channels[channelKey]) {
                currentConfig.notification.channels[channelKey] = {};
            }

            // è¿½åŠ å¤šè´¦å·ï¼ˆä½¿ç”¨åˆ†å·åˆ†éš”ï¼‰
            Object.keys(channelData).forEach(field => {
                const newValue = channelData[field];
                const existingValue = currentConfig.notification.channels[channelKey][field];

                if (existingValue && existingValue.trim()) {
                    // å·²æœ‰å€¼ï¼Œè¿½åŠ æ–°å€¼ï¼ˆç”¨åˆ†å·åˆ†éš”ï¼‰
                    currentConfig.notification.channels[channelKey][field] = existingValue + ';' + newValue;
                } else {
                    // æ²¡æœ‰å€¼ï¼Œç›´æ¥è®¾ç½®
                    currentConfig.notification.channels[channelKey][field] = newValue;
                }
            });

            closeModal();
            saveNotificationConfig();
        }

        // åˆ é™¤æ¸ é“é…ç½®
        function deleteChannel(channelKey) {
            if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤æ¸ é“çš„é…ç½®å—ï¼Ÿ')) {
                // æ¸…ç©ºè¯¥æ¸ é“çš„æ‰€æœ‰é…ç½®
                if (currentConfig.notification.channels[channelKey]) {
                    Object.keys(currentConfig.notification.channels[channelKey]).forEach(key => {
                        currentConfig.notification.channels[channelKey][key] = '';
                    });
                }
                saveNotificationConfig();
            }
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            const modal = document.querySelector('.modal');
            if (modal) {
                modal.remove();
            }
        }

        // ä¿å­˜é€šçŸ¥é…ç½®
        async function saveNotificationConfig() {
            try {
                const response = await fetch('/api/config/notification', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentConfig.notification)
                });

                const result = await response.json();
                if (result.success) {
                    showToast('é€šçŸ¥é…ç½®ä¿å­˜æˆåŠŸ');
                    loadConfig(); // é‡æ–°åŠ è½½é…ç½®ä»¥æ›´æ–°ç•Œé¢
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ¸²æŸ“ RSS é…ç½®
        function renderRSSConfig() {
            const rss = currentConfig.rss || {};
            document.getElementById('rss-enabled').checked = rss.enabled || false;

            // æ–°é²œåº¦è¿‡æ»¤é…ç½®
            const freshness = rss.freshness_filter || {};
            document.getElementById('rss-freshness-enabled').checked = freshness.enabled !== false;
            document.getElementById('rss-max-age-days').value = freshness.max_age_days || 3;

            const container = document.getElementById('rss-feeds-container');
            const feeds = rss.feeds || [];

            container.innerHTML = '<div class="rss-feed-list">' + feeds.map((feed, index) => `
                <div class="rss-feed-item">
                    <div class="form-group">
                        <label>åç§°</label>
                        <input type="text" value="${feed.name || ''}" data-feed-index="${index}" data-field="name">
                    </div>
                    <div class="form-group">
                        <label>URL</label>
                        <input type="text" value="${feed.url || ''}" data-feed-index="${index}" data-field="url">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" ${feed.enabled !== false ? 'checked' : ''} data-feed-index="${index}" data-field="enabled">
                            å¯ç”¨æ­¤è®¢é˜…æº
                        </label>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="deleteRSSFeed(${index})">ğŸ—‘ï¸ åˆ é™¤</button>
                </div>
            `).join('') + '</div>';
        }

        // æ·»åŠ  RSS è®¢é˜…æº
        function addRSSFeed() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>æ·»åŠ  RSS è®¢é˜…æº</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>åç§°</label>
                            <input type="text" id="new-rss-name" placeholder="ä¾‹å¦‚: Hacker News">
                        </div>
                        <div class="form-group">
                            <label>URL</label>
                            <input type="text" id="new-rss-url" placeholder="ä¾‹å¦‚: https://hnrss.org/frontpage">
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="new-rss-enabled" checked>
                                å¯ç”¨æ­¤è®¢é˜…æº
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="confirmAddRSSFeed()">ç¡®è®¤æ·»åŠ </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ç¡®è®¤æ·»åŠ  RSS è®¢é˜…æº
        function confirmAddRSSFeed() {
            const name = document.getElementById('new-rss-name').value;
            const url = document.getElementById('new-rss-url').value;
            const enabled = document.getElementById('new-rss-enabled').checked;

            if (!name || !url) {
                showToast('è¯·å¡«å†™åç§°å’ŒURL', 'error');
                return;
            }

            if (!currentConfig.rss.feeds) {
                currentConfig.rss.feeds = [];
            }

            currentConfig.rss.feeds.push({
                id: name.toLowerCase().replace(/\s+/g, '-'),
                name: name,
                url: url,
                enabled: enabled
            });

            closeModal();
            saveRSSConfig();
        }

        // åˆ é™¤ RSS è®¢é˜…æº
        function deleteRSSFeed(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤RSSè®¢é˜…æºå—ï¼Ÿ')) {
                currentConfig.rss.feeds.splice(index, 1);
                saveRSSConfig();
            }
        }

        // ä¿å­˜ RSS é…ç½®
        async function saveRSSConfig() {
            const enabled = document.getElementById('rss-enabled').checked;
            const freshnessEnabled = document.getElementById('rss-freshness-enabled').checked;
            const maxAgeDays = parseInt(document.getElementById('rss-max-age-days').value) || 3;

            const feedInputs = document.querySelectorAll('.rss-feed-item input');
            const feeds = [];

            const feedsMap = {};
            feedInputs.forEach(input => {
                const index = input.dataset.feedIndex;
                const field = input.dataset.field;

                if (!feedsMap[index]) {
                    feedsMap[index] = {};
                }

                if (input.type === 'checkbox') {
                    feedsMap[index][field] = input.checked;
                } else {
                    feedsMap[index][field] = input.value;
                }
            });

            Object.values(feedsMap).forEach(feed => feeds.push(feed));

            try {
                const response = await fetch('/api/config/rss', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ...currentConfig.rss,
                        enabled: enabled,
                        freshness_filter: {
                            enabled: freshnessEnabled,
                            max_age_days: maxAgeDays
                        },
                        feeds: feeds
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showToast('RSS é…ç½®ä¿å­˜æˆåŠŸ');
                    loadConfig();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ¸²æŸ“æ–°é—»å¹³å°
        function renderPlatforms() {
            const container = document.getElementById('platforms-list');
            const platforms = currentConfig.platforms || [];

            container.innerHTML = platforms.map((platform, index) => `
                <div class="platform-item">
                    <span>${platform.name}</span>
                    <button class="btn btn-danger btn-sm" onclick="deletePlatform(${index})">ğŸ—‘ï¸</button>
                </div>
            `).join('');
        }

        // æ·»åŠ æ–°é—»å¹³å°
        function addPlatform() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>æ·»åŠ æ–°é—»å¹³å°</h3>
                        <button class="modal-close" onclick="closeModal()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>å¹³å°ID</label>
                            <input type="text" id="new-platform-id" placeholder="ä¾‹å¦‚: weibo">
                            <div class="hint">å¹³å°çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œä½¿ç”¨å°å†™è‹±æ–‡</div>
                        </div>
                        <div class="form-group">
                            <label>å¹³å°åç§°</label>
                            <input type="text" id="new-platform-name" placeholder="ä¾‹å¦‚: å¾®åš">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                        <button class="btn btn-primary" onclick="confirmAddPlatform()">ç¡®è®¤æ·»åŠ </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // ç¡®è®¤æ·»åŠ æ–°é—»å¹³å°
        function confirmAddPlatform() {
            const id = document.getElementById('new-platform-id').value;
            const name = document.getElementById('new-platform-name').value;

            if (!id || !name) {
                showToast('è¯·å¡«å†™å¹³å°IDå’Œåç§°', 'error');
                return;
            }

            if (!currentConfig.platforms) {
                currentConfig.platforms = [];
            }

            // æ£€æŸ¥IDæ˜¯å¦é‡å¤
            if (currentConfig.platforms.some(p => p.id === id)) {
                showToast('å¹³å°IDå·²å­˜åœ¨', 'error');
                return;
            }

            currentConfig.platforms.push({
                id: id,
                name: name
            });

            closeModal();
            savePlatformsConfig();
        }

        // åˆ é™¤æ–°é—»å¹³å°
        function deletePlatform(index) {
            if (confirm('ç¡®å®šè¦åˆ é™¤æ­¤æ–°é—»å¹³å°å—ï¼Ÿ')) {
                currentConfig.platforms.splice(index, 1);
                savePlatformsConfig();
            }
        }

        // ä¿å­˜å¹³å°é…ç½®
        async function savePlatformsConfig() {
            try {
                const response = await fetch('/api/config/platforms', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentConfig.platforms)
                });

                const result = await response.json();
                if (result.success) {
                    showToast('å¹³å°é…ç½®ä¿å­˜æˆåŠŸ');
                    loadConfig(); // é‡æ–°åŠ è½½é…ç½®ä»¥æ›´æ–°ç•Œé¢
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        // åŠ è½½å…³é”®è¯
        async function loadKeywords() {
            try {
                const response = await fetch('/api/keywords');
                const result = await response.json();
                if (result.success) {
                    document.getElementById('keywords-textarea').value = result.data;
                }
            } catch (error) {
                showToast('å…³é”®è¯åŠ è½½å¤±è´¥: ' + error.message, 'error');
            }
        }

        // ä¿å­˜å…³é”®è¯
        async function saveKeywords() {
            const content = document.getElementById('keywords-textarea').value;

            try {
                const response = await fetch('/api/keywords', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ content: content })
                });

                const result = await response.json();
                if (result.success) {
                    showToast('å…³é”®è¯ä¿å­˜æˆåŠŸ');
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        // åŠ è½½æŠ¥å‘Šé…ç½®
        function loadReportConfig() {
            const report = currentConfig.report || {};
            document.getElementById('report-mode').value = report.mode || 'current';
            document.getElementById('report-display-mode').value = report.display_mode || 'keyword';
            document.getElementById('report-rank-threshold').value = report.rank_threshold || 5;
            document.getElementById('report-sort-by-position').checked = report.sort_by_position_first || false;
            document.getElementById('report-max-news').value = report.max_news_per_keyword || 0;
            document.getElementById('report-reverse-order').checked = report.reverse_content_order || false;
        }

        // ä¿å­˜æŠ¥å‘Šé…ç½®
        async function saveReportConfig() {
            try {
                const response = await fetch('/api/config/report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode: document.getElementById('report-mode').value,
                        display_mode: document.getElementById('report-display-mode').value,
                        rank_threshold: parseInt(document.getElementById('report-rank-threshold').value) || 5,
                        sort_by_position_first: document.getElementById('report-sort-by-position').checked,
                        max_news_per_keyword: parseInt(document.getElementById('report-max-news').value) || 0,
                        reverse_content_order: document.getElementById('report-reverse-order').checked
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showToast('æŠ¥å‘Šé…ç½®ä¿å­˜æˆåŠŸ');
                    loadConfig();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        // åŠ è½½æ¨é€çª—å£é…ç½®
        function loadPushWindowConfig() {
            const notification = currentConfig.notification || {};
            const pushWindow = notification.push_window || {};
            document.getElementById('push-window-enabled').checked = pushWindow.enabled || false;
            document.getElementById('push-window-start').value = pushWindow.start || '20:00';
            document.getElementById('push-window-end').value = pushWindow.end || '22:00';
            document.getElementById('push-window-once').checked = pushWindow.once_per_day !== false;
        }

        // ä¿å­˜æ¨é€çª—å£é…ç½®
        async function savePushWindowConfig() {
            try {
                const response = await fetch('/api/config/push-window', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        enabled: document.getElementById('push-window-enabled').checked,
                        start: document.getElementById('push-window-start').value,
                        end: document.getElementById('push-window-end').value,
                        once_per_day: document.getElementById('push-window-once').checked
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showToast('æ¨é€çª—å£é…ç½®ä¿å­˜æˆåŠŸ');
                    loadConfig();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        // åŠ è½½å­˜å‚¨é…ç½®
        function loadStorageConfig() {
            const storage = currentConfig.storage || {};
            const formats = storage.formats || {};
            const local = storage.local || {};
            const remote = storage.remote || {};
            const pull = storage.pull || {};

            document.getElementById('storage-backend').value = storage.backend || 'auto';
            document.getElementById('storage-format-txt').checked = formats.txt || false;
            document.getElementById('storage-format-html').checked = formats.html || false;
            document.getElementById('storage-local-dir').value = local.data_dir || 'output';
            document.getElementById('storage-local-retention').value = local.retention_days || 0;
            document.getElementById('storage-remote-endpoint').value = remote.endpoint_url || '';
            document.getElementById('storage-remote-bucket').value = remote.bucket_name || '';
            document.getElementById('storage-remote-access-key').value = remote.access_key_id || '';
            document.getElementById('storage-remote-secret-key').value = remote.secret_access_key || '';
            document.getElementById('storage-remote-region').value = remote.region || '';
            document.getElementById('storage-remote-retention').value = remote.retention_days || 0;
            document.getElementById('storage-pull-enabled').checked = pull.enabled || false;
            document.getElementById('storage-pull-days').value = pull.days || 7;
        }

        // ä¿å­˜å­˜å‚¨é…ç½®
        async function saveStorageConfig() {
            try {
                const response = await fetch('/api/config/storage', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        backend: document.getElementById('storage-backend').value,
                        formats: {
                            sqlite: true,
                            txt: document.getElementById('storage-format-txt').checked,
                            html: document.getElementById('storage-format-html').checked
                        },
                        local: {
                            data_dir: document.getElementById('storage-local-dir').value,
                            retention_days: parseInt(document.getElementById('storage-local-retention').value) || 0
                        },
                        remote: {
                            endpoint_url: document.getElementById('storage-remote-endpoint').value,
                            bucket_name: document.getElementById('storage-remote-bucket').value,
                            access_key_id: document.getElementById('storage-remote-access-key').value,
                            secret_access_key: document.getElementById('storage-remote-secret-key').value,
                            region: document.getElementById('storage-remote-region').value,
                            retention_days: parseInt(document.getElementById('storage-remote-retention').value) || 0
                        },
                        pull: {
                            enabled: document.getElementById('storage-pull-enabled').checked,
                            days: parseInt(document.getElementById('storage-pull-days').value) || 7
                        }
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showToast('å­˜å‚¨é…ç½®ä¿å­˜æˆåŠŸ');
                    loadConfig();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        // åŠ è½½é«˜çº§é…ç½®
        function loadAdvancedConfig() {
            const app = currentConfig.app || {};
            const advanced = currentConfig.advanced || {};
            const crawler = advanced.crawler || {};
            const rss = advanced.rss || {};
            const weight = advanced.weight || {};

            document.getElementById('app-timezone').value = app.timezone || 'Asia/Shanghai';
            document.getElementById('app-show-version-update').checked = app.show_version_update !== false;

            document.getElementById('crawler-enabled').checked = crawler.enabled !== false;
            document.getElementById('crawler-interval').value = crawler.request_interval || 1000;
            document.getElementById('crawler-use-proxy').checked = crawler.use_proxy || false;
            document.getElementById('crawler-proxy').value = crawler.default_proxy || '';

            document.getElementById('rss-adv-interval').value = rss.request_interval || 2000;
            document.getElementById('rss-adv-timeout').value = rss.timeout || 15;
            document.getElementById('rss-adv-use-proxy').checked = rss.use_proxy || false;
            document.getElementById('rss-adv-proxy').value = rss.proxy_url || '';
            document.getElementById('rss-adv-notification').checked = rss.notification_enabled !== false;

            document.getElementById('weight-rank').value = weight.rank || 0.6;
            document.getElementById('weight-frequency').value = weight.frequency || 0.3;
            document.getElementById('weight-hotness').value = weight.hotness || 0.1;

            document.getElementById('max-accounts').value = advanced.max_accounts_per_channel || 3;
            document.getElementById('batch-interval').value = advanced.batch_send_interval || 3;
        }

        // ä¿å­˜é«˜çº§é…ç½®
        async function saveAdvancedConfig() {
            try {
                // ä¿å­˜åº”ç”¨é…ç½®
                await fetch('/api/config/app', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        timezone: document.getElementById('app-timezone').value,
                        show_version_update: document.getElementById('app-show-version-update').checked
                    })
                });

                // ä¿å­˜é«˜çº§é…ç½®
                const response = await fetch('/api/config/advanced', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        ...currentConfig.advanced,
                        crawler: {
                            enabled: document.getElementById('crawler-enabled').checked,
                            request_interval: parseInt(document.getElementById('crawler-interval').value) || 1000,
                            use_proxy: document.getElementById('crawler-use-proxy').checked,
                            default_proxy: document.getElementById('crawler-proxy').value
                        },
                        rss: {
                            request_interval: parseInt(document.getElementById('rss-adv-interval').value) || 2000,
                            timeout: parseInt(document.getElementById('rss-adv-timeout').value) || 15,
                            use_proxy: document.getElementById('rss-adv-use-proxy').checked,
                            proxy_url: document.getElementById('rss-adv-proxy').value,
                            notification_enabled: document.getElementById('rss-adv-notification').checked
                        },
                        weight: {
                            rank: parseFloat(document.getElementById('weight-rank').value) || 0.6,
                            frequency: parseFloat(document.getElementById('weight-frequency').value) || 0.3,
                            hotness: parseFloat(document.getElementById('weight-hotness').value) || 0.1
                        },
                        max_accounts_per_channel: parseInt(document.getElementById('max-accounts').value) || 3,
                        batch_send_interval: parseFloat(document.getElementById('batch-interval').value) || 3
                    })
                });

                const result = await response.json();
                if (result.success) {
                    showToast('é«˜çº§é…ç½®ä¿å­˜æˆåŠŸ');
                    loadConfig();
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        // é‡å¯å®¹å™¨
        async function restartContainer() {
            if (!confirm('ç¡®å®šè¦é‡å¯ TrendRadar å®¹å™¨å—ï¼Ÿ')) return;

            try {
                const response = await fetch('/api/restart', { method: 'POST' });
                const result = await response.json();
                showToast(result.message, result.success ? 'success' : 'error');
            } catch (error) {
                showToast('é‡å¯å¤±è´¥: ' + error.message, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', loadConfig);
    </script>
</body>
</html>
